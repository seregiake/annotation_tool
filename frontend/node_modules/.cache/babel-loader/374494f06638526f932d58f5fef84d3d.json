{"ast":null,"code":"var _jsxFileName = \"/Users/serenagiachetti/Desktop/projects/annotation_tool/frontend/src/containers/AnnotationView.js\";\nimport React, { Component } from 'react';\nimport axios from 'axios';\nimport BackgroundCanvas from '../components/BackgroundCanvas';\nimport ColorCanvas from '../components/ColorCanvas';\nimport OutlineCanvas from '../components/OutlineCanvas'; // import MaskSection from '../components/MaskSection';\n\nimport { Col, Row } from \"react-bootstrap\";\nimport { Button, Form, Input } from \"antd\"; // import AnnotationSection from \"../components/AnnotationSection\";\n\nclass AnnotationView extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      item: [],\n      mask: [],\n      task: [],\n      categories: [],\n      annotation: [],\n      imageID: this.props.match.params.imageID,\n      taskID: this.props.match.params.taskID,\n      outlineColor: [0, 0, 0, 127],\n      hexMaskColor: '#000000',\n      outlineLabel: '50%',\n      outlineRange: 50,\n      annColor: [255, 0, 0, 255],\n      hexAnnColor: '#FF0000',\n      annLabel: '50%',\n      annRange: 50,\n      drawingAreaX: 0,\n      drawingAreaY: 0,\n      canvasWidth: 0,\n      canvasHeight: 0,\n      clusterID: 0,\n      clusterList: [],\n      pointList: [],\n      draggedPointList: [],\n      draggedMaskPointList: [],\n      mouseDrag: false,\n      curColor: [255, 0, 0]\n    };\n\n    this.fetchImage = () => {\n      this.setState({\n        imageID: this.props.match.params.imageID,\n        taskID: this.props.match.params.taskID\n      });\n      axios.get(\"http://127.0.0.1:5000/image/\" + this.state.imageID).then(res => {\n        this.setState({\n          item: res.data\n        }); // console.log(this.state);\n      });\n      axios.get(\"http://127.0.0.1:5000/tasks/\" + this.state.taskID).then(res => {\n        this.setState({\n          task: res.data\n        });\n        axios.get(\"http://127.0.0.1:5000/categories/\" + this.state.task.super_id).then(res => {\n          this.setState({\n            categories: res.data\n          });\n        }); // console.log(this.state);\n\n        const user_id = 1;\n        axios.get(\"http://127.0.0.1:5000/masks/\" + user_id + \"/\" + this.state.imageID + \"/\" + this.state.task.super_id).then(res => {\n          this.setState({\n            mask: res.data\n          });\n          console.log(this.state);\n        });\n      });\n    };\n\n    this.handleMaskSubmit = event => {\n      //event.preventDefault();\n      const kernel = event.target.elements.kernel.value;\n      const dist = event.target.elements.dist.value;\n      const ratio = event.target.elements.ratio.value;\n      const user_id = 1;\n      let requestType = 'POST';\n\n      if (typeof this.state.mask != 'string') {\n        requestType = 'PUT';\n      }\n\n      console.log(this.state.imageID);\n\n      switch (requestType) {\n        case 'POST':\n          return axios.post('http://localhost:5000/masks/' + user_id, {\n            id: this.state.imageID,\n            super: this.state.task.super_id,\n            ratio: ratio,\n            kernel: kernel,\n            dist: dist\n          }).then(res => console.log(res)).catch(error => console.err(error));\n\n        case 'PUT':\n          return axios.put('http://localhost:5000/masks/' + user_id + \"/\" + this.state.imageID + \"/\" + this.state.task.super_id, {\n            id: this.state.imageID,\n            super: this.state.task.super_id,\n            ratio: ratio,\n            kernel: kernel,\n            dist: dist\n          }).then(res => console.log(res)).catch(error => console.err(error));\n\n        default:\n          return;\n      }\n    };\n\n    this.handleAnnSubmit = event => {\n      //event.preventDefault();\n      const kernel = event.target.elements.kernel.value;\n      const dist = event.target.elements.dist.value;\n      const ratio = event.target.elements.ratio.value;\n      const user_id = 1;\n      let requestType = 'POST';\n\n      if (typeof this.state.mask != 'string') {\n        requestType = 'PUT';\n      }\n\n      console.log(this.state.imageID);\n\n      switch (requestType) {\n        case 'POST':\n          return axios.post('http://localhost:5000/masks/' + user_id, {\n            id: this.state.imageID,\n            super: this.state.task.super_id,\n            ratio: ratio,\n            kernel: kernel,\n            dist: dist\n          }).then(res => console.log(res)).catch(error => console.err(error));\n\n        case 'PUT':\n          return axios.put('http://localhost:5000/masks/' + user_id + \"/\" + this.state.imageID + \"/\" + this.state.task.super_id, {\n            id: this.state.imageID,\n            super: this.state.task.super_id,\n            ratio: ratio,\n            kernel: kernel,\n            dist: dist\n          }).then(res => console.log(res)).catch(error => console.err(error));\n\n        default:\n          return;\n      }\n    };\n  }\n\n  componentDidMount() {\n    this.fetchImage(); // console.log(this.state);\n  }\n\n  componentDidUpdate() {\n    this.updateMaskSettings();\n    this.createAnnSettings();\n    this.updateCanvas();\n  }\n\n  updateCanvas() {\n    const canvas = this.refs.top;\n    const context = canvas.getContext('2d'); // eslint-disable-next-line\n\n    if (this.state.item.size != undefined) {\n      context.canvas.width = this.state.item.size[0];\n      context.canvas.height = this.state.item.size[1];\n      context.clearRect(0, 0, this.state.item.size[0], this.state.item.size[1]); // draw children “components”\n      //outline({context, boundaries, size, color});\n    }\n  }\n\n  updateMaskSettings() {\n    const kernel = document.getElementById('kernel');\n    const dist = document.getElementById('dist');\n    const ratio = document.getElementById('ratio'); // eslint-disable-next-line\n\n    if (this.state.mask.kernel != undefined) {\n      kernel.value = this.state.mask.kernel;\n      dist.value = this.state.mask.dist;\n      ratio.value = this.state.mask.ratio; // console.log(kernel.value);\n      // console.log(dist.value);\n      // console.log(ratio.value);\n    }\n  }\n\n  createAnnSettings() {\n    // eslint-disable-next-line\n    if (this.state.task.super_id != undefined) {\n      let select = document.getElementById('ann_class');\n      select.innerText = \"\";\n      let option = document.createElement(\"option\");\n      option.id = \"0\";\n      option.value = \"0\";\n      option.label = \"\";\n      select.append(option);\n      let index = 0;\n\n      for (let i = 0; i < this.state.categories.length; i++) {\n        index = index + 1;\n        option = document.createElement(\"option\");\n        option.id = index;\n        option.value = this.state.categories[i][\"id\"];\n        option.label = this.state.categories[i]['name'];\n        select.append(option);\n      }\n    }\n  }\n\n  clickMouse(event) {\n    const canvas = this.refs.top;\n    const context = canvas.getContext('2d');\n    let colorLayerData = context.getImageData(0, 0, canvas.width, canvas.height);\n    let colorImage = colorLayerData.data;\n    console.log(canvas.width);\n    console.log(canvas.height); // Update the canvas with the new data\n\n    let [x, y] = this.getMousePos(event);\n    console.log(\"x: \" + x + \", y: \" + y); //this.paintAt(x, y, colorImage);\n\n    context.putImageData(colorLayerData, 0, 0, 0, 0);\n    context.putImageData(imgData, canvasX, canvasY, srcX, srcY, srcWidth, srcHeight);\n    console.log(context.getImageData(0, 0, canvas.width, canvas.width).data);\n    context.save();\n  }\n\n  getMousePos(e) {\n    const {\n      size\n    } = this.props;\n    let color_canvas = this.refs.top;\n    let drawingAreaX = color_canvas.getBoundingClientRect().left;\n    let drawingAreaY = color_canvas.getBoundingClientRect().top;\n    this.setState(prevState => {\n      return {\n        drawingAreaX: drawingAreaX,\n        drawingAreaY: drawingAreaY,\n        canvasWidth: prevState.item.size[0],\n        canvasHeight: prevState.item.size[1]\n      };\n    });\n    console.log(this.state); // mouse click coordinates on the canvas rounded to manage float case\n\n    let mouseX = Math.round(e.pageX - document.body.scrollLeft - document.documentElement.scrollLeft - drawingAreaX),\n        mouseY = Math.round(e.pageY - document.body.scrollTop - document.documentElement.scrollTop - drawingAreaY);\n    return [mouseX, mouseY];\n  }\n\n  render() {\n    const {\n      item,\n      mask,\n      task,\n      imageID\n    } = this.state;\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 284\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      id: \"canvases_div\",\n      className: \"overflow-auto\",\n      style: {\n        position: 'relative',\n        minHeight: '300px',\n        background: 'yellow'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 285\n      },\n      __self: this\n    }, React.createElement(BackgroundCanvas, {\n      image: item,\n      size: item.size,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 286\n      },\n      __self: this\n    }), React.createElement(\"canvas\", {\n      id: \"color\",\n      ref: \"top\",\n      style: {\n        zIndex: 3,\n        position: 'absolute'\n      },\n      onClick: event => this.clickMouse(event),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 287\n      },\n      __self: this\n    }, \"Sorry, your browser doesn't support the <canvas> element.\"), React.createElement(OutlineCanvas, {\n      size: item.size,\n      boundaries: mask.boundaries,\n      color: this.state.outlineColor,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 293\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      style: {\n        paddingTop: 20,\n        minHeight: '800px',\n        color: 'rgb(25, 25, 112)'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 297\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      style: {\n        position: 'relative',\n        width: '100%',\n        height: '100%'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 299\n      },\n      __self: this\n    }, React.createElement(Col, {\n      style: {\n        position: 'absolute',\n        marginTop: 20,\n        marginBottom: 20,\n        width: '100%'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 300\n      },\n      __self: this\n    }, React.createElement(\"h3\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 301\n      },\n      __self: this\n    }, \"\\u2699 Mask Settings \\u2699\"), React.createElement(Form, {\n      onSubmit: event => this.handleMaskSubmit(event),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 303\n      },\n      __self: this\n    }, React.createElement(Row, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 305\n      },\n      __self: this\n    }, React.createElement(Col, {\n      xs: true,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 306\n      },\n      __self: this\n    }, React.createElement(Form.Item, {\n      label: \"Kernel\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 307\n      },\n      __self: this\n    }, React.createElement(Input, {\n      id: \"kernel\",\n      type: \"number\",\n      min: 0,\n      defaultValue: mask.kernel,\n      \"data-toggle\": \"tooltip\",\n      \"data-placement\": \"bottom\",\n      style: {\n        width: '50%'\n      },\n      title: \"Kernel: Width of Gaussian kernel used in smoothing the sample density. Higher means fewer clusters.\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 308\n      },\n      __self: this\n    }))), \" \", React.createElement(Col, {\n      xs: true,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 312\n      },\n      __self: this\n    }, React.createElement(Form.Item, {\n      label: \"Max-dist\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 313\n      },\n      __self: this\n    }, React.createElement(Input, {\n      id: \"dist\",\n      type: \"number\",\n      min: 0,\n      defaultValue: mask.dist,\n      \"data-toggle\": \"tooltip\",\n      \"data-placement\": \"bottom\",\n      style: {\n        width: '50%'\n      },\n      title: \"Max-dist: Cut-off point for data distances. Higher means fewer clusters.\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 314\n      },\n      __self: this\n    }))), \" \", React.createElement(Col, {\n      xs: true,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 318\n      },\n      __self: this\n    }, React.createElement(Form.Item, {\n      label: \"Ratio\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 319\n      },\n      __self: this\n    }, React.createElement(Input, {\n      id: \"ratio\",\n      type: \"number\",\n      min: 0,\n      step: 0.1,\n      precision: 1,\n      max: 1,\n      defaultValue: mask.ratio,\n      \"data-toggle\": \"tooltip\",\n      \"data-placement\": \"bottom\",\n      style: {\n        width: '50%'\n      },\n      title: \"Ratio: (between 0 and 1). Balances color-space proximity and image-space proximity. Higher values give more weight to color-space.\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 320\n      },\n      __self: this\n    })))), React.createElement(Form.Item, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 327\n      },\n      __self: this\n    }, React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 328\n      },\n      __self: this\n    }), React.createElement(Button, {\n      htmlType: \"submit\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 329\n      },\n      __self: this\n    }, \"Create\"), React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 330\n      },\n      __self: this\n    }))), React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 335\n      },\n      __self: this\n    }), React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 335\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      style: {\n        width: '100%',\n        border: '2px dotted rgb(25, 25, 112)',\n        padding: 20,\n        background: 'rgba(112, 112, 136, 0.2)',\n        color: 'rgb(25, 25, 112)'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 338\n      },\n      __self: this\n    }, React.createElement(\"h5\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 339\n      },\n      __self: this\n    }, \"\\u2042 Mask Color & Opacity \\u2042\"), React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 340\n      },\n      __self: this\n    }), React.createElement(Col, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 341\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"form-row\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 342\n      },\n      __self: this\n    }, React.createElement(\"label\", {\n      htmlFor: \"opacity\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 343\n      },\n      __self: this\n    }, \"Opacity:\"), React.createElement(\"datalist\", {\n      id: \"rate\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 344\n      },\n      __self: this\n    }, React.createElement(\"option\", {\n      value: \"0\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 345\n      },\n      __self: this\n    }), React.createElement(\"option\", {\n      value: \"10\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 346\n      },\n      __self: this\n    }), React.createElement(\"option\", {\n      value: \"20\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 347\n      },\n      __self: this\n    }), React.createElement(\"option\", {\n      value: \"30\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 348\n      },\n      __self: this\n    }), React.createElement(\"option\", {\n      value: \"40\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 349\n      },\n      __self: this\n    }), React.createElement(\"option\", {\n      value: \"50\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 350\n      },\n      __self: this\n    }), React.createElement(\"option\", {\n      value: \"60\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 351\n      },\n      __self: this\n    }), React.createElement(\"option\", {\n      value: \"70\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 352\n      },\n      __self: this\n    }), React.createElement(\"option\", {\n      value: \"80\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 353\n      },\n      __self: this\n    }), React.createElement(\"option\", {\n      value: \"90\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 354\n      },\n      __self: this\n    }), React.createElement(\"option\", {\n      value: \"100\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 355\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      className: \"col-9\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 357\n      },\n      __self: this\n    }, React.createElement(\"input\", {\n      type: \"range\",\n      id: \"opacity\",\n      className: \"form-control-range\",\n      min: \"0\",\n      max: \"100\",\n      step: \"10\",\n      value: this.state.outlineRange,\n      onChange: event => this.changeOpacity(event),\n      list: \"rate\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 358\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      className: \"col\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 364\n      },\n      __self: this\n    }, React.createElement(\"input\", {\n      type: \"text\",\n      id: \"mask_op_value\",\n      disabled: true,\n      value: this.state.outlineLabel,\n      size: \"4\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 365\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      className: \"col\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 367\n      },\n      __self: this\n    }, React.createElement(\"label\", {\n      htmlFor: \"mask_color\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 368\n      },\n      __self: this\n    }, \"Color:\"), React.createElement(\"input\", {\n      type: \"color\",\n      id: \"mask_color\",\n      defaultValue: this.state.hexMaskColor,\n      onChange: event => this.changeMaskColor(event),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 369\n      },\n      __self: this\n    }))))), React.createElement(\"div\", {\n      style: {\n        width: '100%',\n        height: '100%',\n        marginTop: 20,\n        marginBottom: 20\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 377\n      },\n      __self: this\n    }, React.createElement(\"h3\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 378\n      },\n      __self: this\n    }, \"\\u270E Annotations \\u270E\"), React.createElement(Row, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 379\n      },\n      __self: this\n    }, React.createElement(Col, {\n      style: {\n        marginTop: 20,\n        marginBottom: 20,\n        width: '100%'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 380\n      },\n      __self: this\n    }, React.createElement(\"h5\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 381\n      },\n      __self: this\n    }, \"Create/Edit an annotation:\"), React.createElement(Form, {\n      onSubmit: event => this.handleAnnSubmit(event),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 382\n      },\n      __self: this\n    }, React.createElement(Row, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 383\n      },\n      __self: this\n    }, React.createElement(\"input\", {\n      type: \"color\",\n      id: \"ann_color\",\n      defaultValue: this.state.hexAnnColor,\n      onChange: event => this.changeAnnColor(event),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 384\n      },\n      __self: this\n    }), React.createElement(\"select\", {\n      id: \"ann_class\",\n      style: {\n        width: '70%'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 386\n      },\n      __self: this\n    }), React.createElement(\"button\", {\n      href: \"#\",\n      onClick: saveAnnotation(),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 389\n      },\n      __self: this\n    }, \"V\"), React.createElement(\"button\", {\n      href: \"#\",\n      onClick: cancelAnnotation(),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 390\n      },\n      __self: this\n    }, \"X\"))), React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 393\n      },\n      __self: this\n    }), React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 394\n      },\n      __self: this\n    }), React.createElement(\"label\", {\n      htmlFor: \"ann_opacity\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 395\n      },\n      __self: this\n    }, \"Opacity:\"), React.createElement(\"datalist\", {\n      id: \"rate\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 396\n      },\n      __self: this\n    }, React.createElement(\"option\", {\n      value: \"0\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 397\n      },\n      __self: this\n    }), React.createElement(\"option\", {\n      value: \"10\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 398\n      },\n      __self: this\n    }), React.createElement(\"option\", {\n      value: \"20\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 399\n      },\n      __self: this\n    }), React.createElement(\"option\", {\n      value: \"30\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 400\n      },\n      __self: this\n    }), React.createElement(\"option\", {\n      value: \"40\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 401\n      },\n      __self: this\n    }), React.createElement(\"option\", {\n      value: \"50\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 402\n      },\n      __self: this\n    }), React.createElement(\"option\", {\n      value: \"60\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 403\n      },\n      __self: this\n    }), React.createElement(\"option\", {\n      value: \"70\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 404\n      },\n      __self: this\n    }), React.createElement(\"option\", {\n      value: \"80\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 405\n      },\n      __self: this\n    }), React.createElement(\"option\", {\n      value: \"90\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 406\n      },\n      __self: this\n    }), React.createElement(\"option\", {\n      value: \"100\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 407\n      },\n      __self: this\n    })), React.createElement(\"input\", {\n      type: \"range\",\n      id: \"ann_opacity\",\n      className: \"form-control-range\",\n      min: \"0\",\n      max: \"100\",\n      step: \"10\",\n      value: this.state.annRange,\n      onChange: event => this.changeAnnOpacity(event),\n      list: \"rate\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 410\n      },\n      __self: this\n    }), React.createElement(\"input\", {\n      type: \"text\",\n      id: \"ann_op_value\",\n      disabled: true,\n      value: this.state.annLabel,\n      size: \"4\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 416\n      },\n      __self: this\n    })), React.createElement(Col, {\n      style: {\n        marginTop: 20,\n        marginBottom: 20,\n        width: '100%'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 420\n      },\n      __self: this\n    }, React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 423\n      },\n      __self: this\n    }), React.createElement(\"h5\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 424\n      },\n      __self: this\n    }, \"List of annotations:\"))))))));\n  }\n\n  changeOpacity(event) {\n    //console.log('change opacity');\n    let new_opacity = event.target.value;\n    let opacity_value = Math.round(new_opacity * 255 / 100);\n    let opacity_label = new_opacity + \"%\";\n    console.log(opacity_label);\n    console.log(new_opacity);\n    this.setState(prevState => {\n      return {\n        outlineColor: [prevState.outlineColor[0], prevState.outlineColor[1], prevState.outlineColor[2], opacity_value],\n        outlineLabel: opacity_label,\n        outlineRange: new_opacity\n      };\n    });\n  }\n\n  changeAnnOpacity(event) {\n    //console.log('change opacity');\n    let new_opacity = event.target.value;\n    let opacity_value = Math.round(new_opacity * 255 / 100);\n    let opacity_label = new_opacity + \"%\";\n    console.log(opacity_label);\n    console.log(new_opacity);\n    this.setState(prevState => {\n      return {\n        annColor: [prevState.outlineColor[0], prevState.outlineColor[1], prevState.outlineColor[2], opacity_value],\n        annLabel: opacity_label,\n        annRange: new_opacity\n      };\n    });\n  }\n\n  changeMaskColor(event) {\n    //console.log('change color');\n    let hex = event.target.value;\n    let rgb_color = hexToRGB(hex);\n    this.setState(prevState => {\n      return {\n        outlineColor: [rgb_color.r, rgb_color.g, rgb_color.b, prevState.outlineColor[3]],\n        hexMaskColor: hex\n      };\n    });\n  }\n\n  changeAnnColor(event) {\n    //console.log('change color');\n    let hex = event.target.value;\n    let rgb_color = hexToRGB(hex);\n    this.setState(prevState => {\n      return {\n        annColor: [rgb_color.r, rgb_color.g, rgb_color.b, prevState.annColor[3]],\n        hexAnnColor: hex\n      };\n    });\n  }\n\n}\n\nexport default AnnotationView;\n\nfunction saveAnnotation() {// console.log('change opacity');\n}\n\nfunction cancelAnnotation() {// console.log('change opacity');\n}\n\nfunction hexToRGB(hex) {\n  let result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n  return result ? {\n    r: parseInt(result[1], 16),\n    g: parseInt(result[2], 16),\n    b: parseInt(result[3], 16)\n  } : null;\n}\n/*\n\n<ColorCanvas size={item.size} mask={mask.mask} boundaries={mask.boundaries} color={this.state.annColor} />\n\n\n<BackgroundCanvas image={item} size={item.size} />\n                        <ColorCanvas size={item.size} />\n \n                        { this.displayMask(mask, item) }\n\n<ColorCanvas style={{ zIndex: 2, position:'absolute' }} size={item.size} />\n<OutlineCanvas style={{ zIndex: 3, position:'absolute' }} size={item.size} />\n                     \n*/\n// <img src={item.url} alt={item.name} draggable=\"false\" />","map":{"version":3,"sources":["/Users/serenagiachetti/Desktop/projects/annotation_tool/frontend/src/containers/AnnotationView.js"],"names":["React","Component","axios","BackgroundCanvas","ColorCanvas","OutlineCanvas","Col","Row","Button","Form","Input","AnnotationView","state","item","mask","task","categories","annotation","imageID","props","match","params","taskID","outlineColor","hexMaskColor","outlineLabel","outlineRange","annColor","hexAnnColor","annLabel","annRange","drawingAreaX","drawingAreaY","canvasWidth","canvasHeight","clusterID","clusterList","pointList","draggedPointList","draggedMaskPointList","mouseDrag","curColor","fetchImage","setState","get","then","res","data","super_id","user_id","console","log","handleMaskSubmit","event","kernel","target","elements","value","dist","ratio","requestType","post","id","super","catch","error","err","put","handleAnnSubmit","componentDidMount","componentDidUpdate","updateMaskSettings","createAnnSettings","updateCanvas","canvas","refs","top","context","getContext","size","undefined","width","height","clearRect","document","getElementById","select","innerText","option","createElement","label","append","index","i","length","clickMouse","colorLayerData","getImageData","colorImage","x","y","getMousePos","putImageData","imgData","canvasX","canvasY","srcX","srcY","srcWidth","srcHeight","save","e","color_canvas","getBoundingClientRect","left","prevState","mouseX","Math","round","pageX","body","scrollLeft","documentElement","mouseY","pageY","scrollTop","render","position","minHeight","background","zIndex","boundaries","paddingTop","color","marginTop","marginBottom","border","padding","changeOpacity","changeMaskColor","changeAnnColor","saveAnnotation","cancelAnnotation","changeAnnOpacity","new_opacity","opacity_value","opacity_label","hex","rgb_color","hexToRGB","r","g","b","result","exec","parseInt"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport axios from 'axios';\nimport BackgroundCanvas from '../components/BackgroundCanvas';\nimport ColorCanvas from '../components/ColorCanvas';\nimport OutlineCanvas from '../components/OutlineCanvas';\n// import MaskSection from '../components/MaskSection';\nimport {Col, Row} from \"react-bootstrap\";\nimport {Button, Form, Input} from \"antd\";\n// import AnnotationSection from \"../components/AnnotationSection\";\n\n\nclass AnnotationView extends Component {\n\n    state = {\n        item: [],\n        mask: [],\n        task: [],\n        categories: [],\n        annotation: [],\n        imageID: this.props.match.params.imageID,\n        taskID: this.props.match.params.taskID,\n        outlineColor: [0, 0, 0, 127],\n        hexMaskColor: '#000000',\n        outlineLabel: '50%',\n        outlineRange: 50,\n        annColor: [255, 0, 0, 255],\n        hexAnnColor: '#FF0000',\n        annLabel: '50%',\n        annRange: 50,\n\n        drawingAreaX: 0,\n        drawingAreaY: 0,\n        canvasWidth: 0,\n        canvasHeight: 0,\n        clusterID: 0,\n        clusterList: [],\n        pointList: [],\n        draggedPointList: [],\n        draggedMaskPointList: [],\n        mouseDrag: false,\n        curColor: [255, 0, 0],\n\n\n    }\n\n    fetchImage = () => {\n        this.setState({\n            imageID: this.props.match.params.imageID,\n            taskID: this.props.match.params.taskID\n        });\n        axios.get(\"http://127.0.0.1:5000/image/\" + this.state.imageID).then(res => {\n          this.setState({\n            item: res.data\n        });\n        // console.log(this.state);\n        });\n        axios.get(\"http://127.0.0.1:5000/tasks/\" + this.state.taskID).then(res => {\n          this.setState({\n            task: res.data\n        });\n          axios.get(\"http://127.0.0.1:5000/categories/\" + this.state.task.super_id).then(res => {\n          this.setState({\n            categories: res.data\n        })});\n        // console.log(this.state);\n        const user_id = 1;\n        axios.get(\"http://127.0.0.1:5000/masks/\" + user_id + \"/\" + this.state.imageID + \"/\" + this.state.task.super_id).then(res => {\n            this.setState({\n                mask: res.data\n            });\n            console.log(this.state);\n            });\n        });\n        \n    }\n\n\n    componentDidMount(){\n        this.fetchImage();\n        // console.log(this.state);\n    }\n\n    componentDidUpdate(){\n        this.updateMaskSettings();\n        this.createAnnSettings();\n        this.updateCanvas();\n\n    }\n\n    updateCanvas() {\n        const canvas = this.refs.top;\n        const context = canvas.getContext('2d');\n\n        // eslint-disable-next-line\n        if (this.state.item.size  != undefined){\n            context.canvas.width = this.state.item.size[0];\n            context.canvas.height = this.state.item.size[1];\n            context.clearRect(0,0, this.state.item.size[0], this.state.item.size[1]);\n\n            // draw children “components”\n            //outline({context, boundaries, size, color});\n\n        }\n    }\n\n    updateMaskSettings(){\n        const kernel = document.getElementById('kernel');\n        const dist = document.getElementById('dist');\n        const ratio = document.getElementById('ratio');\n\n        // eslint-disable-next-line\n        if (this.state.mask.kernel != undefined){\n            kernel.value = this.state.mask.kernel;\n            dist.value = this.state.mask.dist;\n            ratio.value = this.state.mask.ratio;\n\n            // console.log(kernel.value);\n            // console.log(dist.value);\n            // console.log(ratio.value);\n        }\n\n\n\n    }\n\n    createAnnSettings(){\n        // eslint-disable-next-line\n        if (this.state.task.super_id != undefined){\n\n            let select = document.getElementById('ann_class');\n            select.innerText=\"\";\n            let option = document.createElement(\"option\");\n            option.id = \"0\";\n            option.value = \"0\";\n            option.label =  \"\";\n            select.append(option);\n\n            let index = 0;\n            for( let i = 0; i < this.state.categories.length; i++){\n                index = index + 1;\n                option = document.createElement(\"option\");\n                option.id = index;\n                option.value = this.state.categories[i][\"id\"];\n                option.label =  this.state.categories[i]['name'];\n                select.append(option);\n            }\n\n        }\n    }\n\n    handleMaskSubmit = (event) => {\n        //event.preventDefault();\n        const kernel = event.target.elements.kernel.value;\n        const dist = event.target.elements.dist.value;\n        const ratio = event.target.elements.ratio.value;\n\n        const user_id = 1;\n\n        let requestType = 'POST';\n        if( typeof this.state.mask != 'string' ){\n            requestType = 'PUT';\n        }\n\n        console.log(this.state.imageID);\n\n        switch ( requestType ){\n            case 'POST':\n                return axios.post('http://localhost:5000/masks/' + user_id, {\n                    id: this.state.imageID,\n                    super: this.state.task.super_id,\n                    ratio : ratio,\n                    kernel : kernel,\n                    dist: dist\n                })\n                .then(res => console.log(res))\n                .catch(error => console.err(error));\n            case 'PUT':\n                return axios.put('http://localhost:5000/masks/' + user_id + \"/\" + this.state.imageID + \"/\" + this.state.task.super_id, {\n                    id: this.state.imageID,\n                    super: this.state.task.super_id,\n                    ratio : ratio,\n                    kernel : kernel,\n                    dist: dist\n                })\n                .then(res => console.log(res))\n                .catch(error => console.err(error));\n            default: return\n        }\n    }\n\n    handleAnnSubmit = (event) => {\n        //event.preventDefault();\n        const kernel = event.target.elements.kernel.value;\n        const dist = event.target.elements.dist.value;\n        const ratio = event.target.elements.ratio.value;\n\n        const user_id = 1;\n\n        let requestType = 'POST';\n        if( typeof this.state.mask != 'string' ){\n            requestType = 'PUT';\n        }\n\n        console.log(this.state.imageID);\n\n        switch ( requestType ){\n            case 'POST':\n                return axios.post('http://localhost:5000/masks/' + user_id, {\n                    id: this.state.imageID,\n                    super: this.state.task.super_id,\n                    ratio : ratio,\n                    kernel : kernel,\n                    dist: dist\n                })\n                .then(res => console.log(res))\n                .catch(error => console.err(error));\n            case 'PUT':\n                return axios.put('http://localhost:5000/masks/' + user_id + \"/\" + this.state.imageID + \"/\" + this.state.task.super_id, {\n                    id: this.state.imageID,\n                    super: this.state.task.super_id,\n                    ratio : ratio,\n                    kernel : kernel,\n                    dist: dist\n                })\n                .then(res => console.log(res))\n                .catch(error => console.err(error));\n            default: return\n        }\n    }\n\n    clickMouse(event){\n        const canvas = this.refs.top;\n        const context = canvas.getContext('2d');\n        let colorLayerData = context.getImageData(0, 0, canvas.width, canvas.height);\n        let colorImage = colorLayerData.data;\n        console.log(canvas.width);\n        console.log(canvas.height);\n\n        // Update the canvas with the new data\n\n\n        let [x, y] = this.getMousePos(event);\n        console.log(\"x: \" + x + \", y: \" + y);\n\n\n        //this.paintAt(x, y, colorImage);\n\n        context.putImageData(colorLayerData, 0, 0, 0,0,);\n        context.putImageData(imgData, canvasX, canvasY, srcX ,srcY, srcWidth, srcHeight);\n        console.log(context.getImageData(0, 0, canvas.width, canvas.width).data);\n        context.save();\n\n    }\n\n    getMousePos(e){\n        const {  size } = this.props;\n        let color_canvas = this.refs.top;\n        let drawingAreaX = color_canvas.getBoundingClientRect().left;\n        let drawingAreaY = color_canvas.getBoundingClientRect().top;\n\n        this.setState(prevState => {\n           return {\n                drawingAreaX: drawingAreaX,\n                drawingAreaY: drawingAreaY,\n                canvasWidth: prevState.item.size[0],\n                canvasHeight: prevState.item.size[1],\n           }\n        });\n\n        console.log(this.state);\n\n        // mouse click coordinates on the canvas rounded to manage float case\n        let mouseX = Math.round(e.pageX - document.body.scrollLeft - document.documentElement.scrollLeft - drawingAreaX),\n            mouseY = Math.round(e.pageY - document.body.scrollTop - document.documentElement.scrollTop - drawingAreaY);\n\n        return [mouseX, mouseY];\n\n    }\n\n    \n    render() {\n        const { item, mask, task, imageID } = this.state;\n        return(\n                <div >\n                    <div id=\"canvases_div\" className=\"overflow-auto\" style={{ position:'relative', minHeight:'300px', background:'yellow'}}>\n                        <BackgroundCanvas image={item} size={item.size} />\n                        <canvas id=\"color\"\n                                ref=\"top\"\n                                style={{ zIndex: 3, position:'absolute'}}\n                                onClick={(event) => this.clickMouse(event)}>\n                            Sorry, your browser doesn't support the &lt;canvas&gt; element.\n                        </canvas>\n                        <OutlineCanvas size={item.size} boundaries={mask.boundaries} color={this.state.outlineColor} />\n\n\n                    </div>\n                    <div style={{ paddingTop:20, minHeight:'800px', color:'rgb(25, 25, 112)' }}>\n\n                        <div style={{ position:'relative', width:'100%', height:'100%' }}>\n                            <Col style={{ position:'absolute', marginTop:20, marginBottom:20, width:'100%' }}>\n                                <h3>&#9881; Mask Settings &#9881;</h3>\n\n                                <Form onSubmit={(event) => this.handleMaskSubmit(\n                                    event)} >\n                                <Row>\n                                    <Col xs >\n                                    <Form.Item label=\"Kernel\" >\n                                        <Input id=\"kernel\" type=\"number\" min={0} defaultValue={mask.kernel}\n                                                data-toggle=\"tooltip\" data-placement=\"bottom\" style={{ width:'50%'}}\n                                                title=\"Kernel: Width of Gaussian kernel used in smoothing the sample density. Higher means fewer clusters.\" />\n                                    </Form.Item>\n                                    </Col> <Col xs >\n                                    <Form.Item label=\"Max-dist\">\n                                        <Input id=\"dist\" type=\"number\" min={0} defaultValue={mask.dist}\n                                                data-toggle=\"tooltip\" data-placement=\"bottom\" style={{ width:'50%'}}\n                                                title=\"Max-dist: Cut-off point for data distances. Higher means fewer clusters.\" />\n                                    </Form.Item>\n                                    </Col> <Col xs >\n                                    <Form.Item label=\"Ratio\">\n                                        <Input id=\"ratio\" type=\"number\" min={0} step={0.1} precision={1} max={1} defaultValue={mask.ratio}\n                                                data-toggle=\"tooltip\" data-placement=\"bottom\" style={{ width:'50%'}}\n                                                title=\"Ratio: (between 0 and 1). Balances color-space proximity and image-space proximity. Higher values give more weight to color-space.\" />\n                                    </Form.Item>\n                                    </Col>\n                                </Row>\n\n                                    <Form.Item >\n                                        <br />\n                                        <Button htmlType=\"submit\" >Create</Button>\n                                        <br />\n                                    </Form.Item>\n                                </Form>\n\n\n                                <br /><br />\n\n\n                                <div style={{ width:'100%', border:'2px dotted rgb(25, 25, 112)', padding:20, background:'rgba(112, 112, 136, 0.2)', color:'rgb(25, 25, 112)'}}>\n                                <h5>&#8258; Mask Color &amp; Opacity &#8258;</h5>\n                                <br />\n                                <Col >\n                                <div className=\"form-row\" >\n                                <label htmlFor=\"opacity\">Opacity:</label>\n                                    <datalist id=\"rate\">\n                                        <option value=\"0\"></option>\n                                        <option value=\"10\"></option>\n                                        <option value=\"20\"></option>\n                                        <option value=\"30\"></option>\n                                        <option value=\"40\"></option>\n                                        <option value=\"50\"></option>\n                                        <option value=\"60\"></option>\n                                        <option value=\"70\"></option>\n                                        <option value=\"80\"></option>\n                                        <option value=\"90\"></option>\n                                        <option value=\"100\"></option>\n                                    </datalist>\n                                    <div className=\"col-9\">\n                                        <input type=\"range\" id=\"opacity\"\n                                               className=\"form-control-range\" min=\"0\" max=\"100\" step=\"10\"\n                                               value={ this.state.outlineRange}\n                                               onChange={(event) => this.changeOpacity(event) }\n                                               list=\"rate\" />\n                                    </div>\n                                    <div className=\"col\">\n                                        <input type=\"text\" id=\"mask_op_value\" disabled value={this.state.outlineLabel} size=\"4\" />\n                                    </div>\n                                    <div className=\"col\">\n                                        <label htmlFor=\"mask_color\">Color:</label>\n                                        <input type=\"color\" id=\"mask_color\" defaultValue={this.state.hexMaskColor}\n                                            onChange={(event) => this.changeMaskColor(event)} />\n                                    </div>\n                                </div>\n                                </Col>\n                                </div>\n\n\n                                <div style={{ width:'100%', height:'100%', marginTop:20, marginBottom:20 }}>\n                                    <h3>&#9998; Annotations &#9998;</h3>\n                                    <Row>\n                                        <Col style={{ marginTop:20, marginBottom:20, width:'100%' }}>\n                                            <h5>Create/Edit an annotation:</h5>\n                                            <Form onSubmit={(event) => this.handleAnnSubmit(event)} >\n                                            <Row>\n                                                <input type=\"color\" id=\"ann_color\" defaultValue={this.state.hexAnnColor}\n                                                onChange={(event) => this.changeAnnColor(event)}/>\n                                                <select id=\"ann_class\" style={{ width:'70%' }}>\n\n                                                </select>\n                                                <button href=\"#\" onClick={saveAnnotation()} >V</button>\n                                                <button href=\"#\" onClick={cancelAnnotation()} >X</button>\n                                            </Row>\n                                            </Form>\n                                            <br />\n                                            <br />\n                                            <label htmlFor=\"ann_opacity\">Opacity:</label>\n                                            <datalist id=\"rate\">\n                                                <option value=\"0\"></option>\n                                                <option value=\"10\"></option>\n                                                <option value=\"20\"></option>\n                                                <option value=\"30\"></option>\n                                                <option value=\"40\"></option>\n                                                <option value=\"50\"></option>\n                                                <option value=\"60\"></option>\n                                                <option value=\"70\"></option>\n                                                <option value=\"80\"></option>\n                                                <option value=\"90\"></option>\n                                                <option value=\"100\"></option>\n                                            </datalist>\n\n                                            <input type=\"range\" id=\"ann_opacity\"\n                                                   className=\"form-control-range\" min=\"0\" max=\"100\" step=\"10\"\n                                                   value={ this.state.annRange}\n                                                   onChange={(event) => this.changeAnnOpacity(event) }\n                                                   list=\"rate\" />\n\n                                                   <input type=\"text\" id=\"ann_op_value\" disabled value={this.state.annLabel} size=\"4\" />\n\n\n                                        </Col>\n                                        <Col style={{ marginTop:20, marginBottom:20, width:'100%' }}>\n\n\n                                            <br />\n                                            <h5>List of annotations:</h5>\n\n                                        </Col>\n                                    </Row>\n                                </div>\n\n                            </Col>\n                        </div>\n                    </div> \n                </div>\n    \n           \n        )\n        \n    }\n\n\n    changeOpacity(event){\n        //console.log('change opacity');\n\n        let new_opacity = event.target.value;\n        let opacity_value = Math.round(((new_opacity * 255)/100));\n        let opacity_label = new_opacity + \"%\";\n        console.log(opacity_label);\n        console.log(new_opacity);\n\n        this.setState(prevState =>{\n            return {\n                outlineColor: [prevState.outlineColor[0], prevState.outlineColor[1], prevState.outlineColor[2], opacity_value ],\n                outlineLabel: opacity_label,\n                outlineRange: new_opacity\n            }\n        })\n\n    }\n\n    changeAnnOpacity(event){\n        //console.log('change opacity');\n\n        let new_opacity = event.target.value;\n        let opacity_value = Math.round(((new_opacity * 255)/100));\n        let opacity_label = new_opacity + \"%\";\n        console.log(opacity_label);\n        console.log(new_opacity);\n\n        this.setState(prevState =>{\n            return {\n                annColor: [prevState.outlineColor[0], prevState.outlineColor[1], prevState.outlineColor[2], opacity_value ],\n                annLabel: opacity_label,\n                annRange: new_opacity\n            }\n        })\n\n    }\n\n    changeMaskColor(event){\n        //console.log('change color');\n\n        let hex = event.target.value;\n        let rgb_color = hexToRGB(hex);\n\n        this.setState(prevState =>{\n            return {\n                outlineColor: [rgb_color.r, rgb_color.g, rgb_color.b, prevState.outlineColor[3] ],\n                hexMaskColor: hex,\n            }\n        })\n\n    }\n\n    changeAnnColor(event){\n        //console.log('change color');\n\n        let hex = event.target.value;\n        let rgb_color = hexToRGB(hex);\n\n        this.setState(prevState =>{\n            return {\n                annColor: [rgb_color.r, rgb_color.g, rgb_color.b, prevState.annColor[3] ],\n                hexAnnColor: hex,\n            }\n        })\n\n    }\n}\nexport default AnnotationView;\n\n\nfunction saveAnnotation(){\n    // console.log('change opacity');\n}\n\nfunction cancelAnnotation(){\n    // console.log('change opacity');\n}\n\nfunction hexToRGB(hex) {\n  let result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n  return result ? {\n    r: parseInt(result[1], 16),\n    g: parseInt(result[2], 16),\n    b: parseInt(result[3], 16)\n  } : null;\n}\n\n\n\n/*\n\n<ColorCanvas size={item.size} mask={mask.mask} boundaries={mask.boundaries} color={this.state.annColor} />\n\n\n<BackgroundCanvas image={item} size={item.size} />\n                        <ColorCanvas size={item.size} />\n \n                        { this.displayMask(mask, item) }\n\n<ColorCanvas style={{ zIndex: 2, position:'absolute' }} size={item.size} />\n<OutlineCanvas style={{ zIndex: 3, position:'absolute' }} size={item.size} />\n                     \n*/\n// <img src={item.url} alt={item.name} draggable=\"false\" />\n"]},"metadata":{},"sourceType":"module"}